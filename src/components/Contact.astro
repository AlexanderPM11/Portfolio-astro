---
import {
  FaMapMarkerAlt,
  FaEnvelope,
  FaGithub,
  FaTelegram,
} from "react-icons/fa";

let status = "";
let isSending = false;

async function handleSubmit(e: { preventDefault: () => void; target: any }) {
  e.preventDefault();
  const form = e.target;
  const formData = Object.fromEntries(new FormData(form).entries());

  isSending = true;
  status = "";

  try {
    const res = await fetch("/api/send-message", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData),
    });

    const data = await res.text();
    status = data || "Mensaje enviado con √©xito üéâ";
    form.reset();
  } catch (err) {
    status = "Error al enviar el mensaje ‚ùå";
  }

  isSending = false;
}
---

<section
  id="contact"
  class="py-20 px-4 bg-gradient-to-b from-gray-900 to-black text-white"
>
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-16">
      <h2 class="text-4xl font-bold">
        Ponte en <span class="text-orange-500">Contacto</span>
      </h2>
      <p class="text-gray-400 mt-2">
        ¬øTienes un proyecto en mente o te gustar√≠a colaborar? ¬°Me encantar√≠a
        saber de ti!
      </p>
    </div>

    <div class="flex justify-center flex-wrap gap-6">
      <!-- Formulario -->
      <div
        class="bg-[#111827] max-w-[450px] p-8 rounded-xl shadow-lg border border-white/10"
      >
        <p class="font-medium">Env√≠ame un mensaje</p>
        <p class="text-gray-500 mb-5">
          Completa el formulario y me pondr√© en contacto contigo lo antes
          posible.
        </p>

        <form
          id="contact-form"
          onsubmit="handleSubmit(event)"
          class="space-y-5"
        >
          <div>
            <label for="name" class="block text-sm font-medium text-gray-300">
              Nombre
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full bg-[#1f2937] border border-gray-600 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div>
            <label for="email" class="block text-sm font-medium text-gray-300">
              Correo electr√≥nico
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full bg-[#1f2937] border border-gray-600 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div>
            <label
              for="service"
              class="block text-sm font-medium text-gray-300"
            >
              Asunto
            </label>
            <input
              type="text"
              id="service"
              name="service"
              class="w-full bg-[#1f2937] border border-gray-600 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div>
            <label
              for="message"
              class="block text-sm font-medium text-gray-300"
            >
              Mensaje
            </label>
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              class="w-full bg-[#1f2937] border border-gray-600 rounded px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>

          <button
            type="submit"
            class="w-full font-semibold py-2 rounded transition cursor-pointer bg-white text-black hover:bg-orange-500 hover:text-white"
          >
            Enviar Mensaje
          </button>

          <p id="status" class="text-green-400 text-sm text-center mt-2"></p>
        </form>
      </div>

      <!-- Contact Info -->
      <div
        class="bg-[#111827] max-w-[450px] p-8 rounded-xl shadow-lg border border-white/10 space-y-6"
      >
        <div>
          <h3 class="text-lg font-semibold mb-4">Conecta conmigo</h3>

          <div class="space-y-4">
            <a
              href="https://github.com/AlexanderPM11"
              target="_blank"
              rel="noopener noreferrer"
              class="block"
            >
              <div
                class="flex gap-4 py-6 px-4 rounded-[8px] border border-white/10 hover:shadow-md transition-shadow hover:bg-white/6"
              >
                <div
                  class="flex items-center h-10 p-2 bg-white/10 rounded-full"
                >
                  <FaGithub class:list="text-white text-2xl" />
                </div>
                <div class="flex flex-col justify-center">
                  <p class="text-white font-semibold">GitHub</p>
                  <p class="text-gray-300">github.com/alexanderpolanco</p>
                </div>
              </div>
            </a>

            <a
              href="https://t.me/alexanderJpm"
              target="_blank"
              rel="noopener noreferrer"
              class="block"
            >
              <div
                class="flex gap-4 py-6 px-4 rounded-[8px] border border-white/10 hover:shadow-md transition-shadow hover:bg-white/6"
              >
                <div
                  class="flex items-center h-10 p-2 bg-white/10 rounded-full"
                >
                  <FaTelegram class:list="text-white text-2xl" />
                </div>
                <div class="flex flex-col justify-center">
                  <p class="text-white font-semibold">Telegram</p>
                  <p class="text-gray-300">@alexanderJpm</p>
                </div>
              </div>
            </a>

            <a href="mailto:alexanderdev@apolanco.com" class="block">
              <div
                class="flex gap-4 py-6 px-4 rounded-[8px] border border-white/10 hover:shadow-md transition-shadow hover:bg-white/6"
              >
                <div
                  class="flex items-center h-10 p-2 bg-white/10 rounded-full"
                >
                  <FaEnvelope class:list="text-white text-2xl" />
                </div>
                <div class="flex flex-col justify-center">
                  <p class="text-white font-semibold">Correo</p>
                  <p class="text-gray-300">alexanderdev@apolanco.com</p>
                </div>
              </div>
            </a>

            <div
              class="flex gap-4 py-6 px-4 rounded-[8px] border border-white/10 hover:shadow-md transition-shadow hover:bg-white/6"
            >
              <div class="flex items-center h-10 p-2 bg-white/10 rounded-full">
                <FaMapMarkerAlt class:list="text-white text-2xl" />
              </div>
              <div class="flex flex-col justify-center">
                <p class="text-white font-semibold">Ubicaci√≥n</p>
                <p class="text-gray-300">Santo Domingo, Rep√∫blica Dominicana</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  async function handleSubmit(e: { preventDefault: () => void; target: any }) {
    e.preventDefault();
    const form = e.target;
    const formData = Object.fromEntries(new FormData(form).entries());
    const status = document.getElementById("status");
    const button = form.querySelector("button");

    button.disabled = true;
    button.textContent = "Enviando...";
    status.textContent = "";

    try {
      const res = await fetch("/api/send-message", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      const text = await res.text();
      status.textContent = text || "Mensaje enviado con √©xito üéâ";
      form.reset();
    } catch (err) {
      status.textContent = "Error al enviar el mensaje ‚ùå";
    } finally {
      button.disabled = false;
      button.textContent = "Enviar Mensaje";
    }
  }
</script>
