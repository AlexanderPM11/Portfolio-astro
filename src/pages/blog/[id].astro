---
import { Github, ExternalLink, Calendar, Clock, ArrowLeft } from "lucide-astro";
import { Icon } from "astro-icon/components";
import { sanitizeContent } from "../../util/constants/sanitizedContent";
import Layout from "../../layouts/Layout.astro";
import {
  getProjectById,
  getProjectPaths,
} from "../../services/blog/ProjectService";
import type { ProjectPost } from "../../interface/Project/ProjectInterface";
import { techIcons } from "../../util/constants/TechIcons";

const { id } = Astro.params;

export async function getStaticPaths() {
  return await getProjectPaths();
}

export async function get(id: string) {
  if (!id) {
    throw new Error("❌ ID de proyecto no proporcionado o inválido");
  }

  try {
    const post = await getProjectById(Number(id));
    return { props: { post } };
  } catch (err) {
    console.error("Error al obtener el proyecto:", err);
    return {
      props: {
        post: null,
        error: "No se pudo cargar el proyecto solicitado.",
      },
    };
  }
}

let post: ProjectPost;

const data = await get(id);
post = data.props.post!;

const sanitizedContent = sanitizeContent(post.content?.rendered || "");

// Formatear fecha
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString("es-ES", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};
---

<Layout>

  <!-- Hero Section -->
  <section
    class="relative min-h-screen flex flex-col justify-center bg-linear-to-br from-slate-900 via-slate-800 to-slate-900 pt-24 pb-20 lg:pt-32 lg:pb-28 overflow-hidden"
  >
    <!-- Background Elements -->
    <div class="absolute inset-0">
      <div
        class="absolute top-0 left-0 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2"
      >
      </div>
      <div
        class="absolute bottom-0 right-0 w-96 h-96 bg-orange-500/5 rounded-full blur-3xl translate-x-1/2 translate-y-1/2"
      >
      </div>
      {
        post.image && (
          <img
            src={post.image}
            alt={post.title.rendered}
            class="w-full h-full object-cover opacity-10 scale-110"
            loading="eager"
          />
        )
      }
    </div>

    <!-- Content Container -->
    <div class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Breadcrumb -->
      <nav class="flex items-center gap-2 text-sm text-gray-400 mb-8">
        <a href="/" class="hover:text-orange-400 transition-colors duration-200"
          >Inicio</a
        >
        <span class="text-gray-600">/</span>
        <a
          href="/#projects"
          class="hover:text-orange-400 transition-colors duration-200"
          >Proyectos</a
        >
        <span class="text-gray-600">/</span>
        <span class="text-orange-400 truncate" set:html={post.title.rendered}/>
      </nav>

      <!-- Meta Information -->
      <div class="flex flex-wrap items-center gap-4 mb-8">
        <div
          class="flex items-center gap-2 px-4 py-2 bg-white/5 backdrop-blur-sm rounded-full border border-white/10"
        >
          <Calendar class="w-4 h-4 text-orange-400" />
          <span class="text-sm text-gray-300">{formatDate(post.date)}</span>
        </div>
      </div>

      <!-- Title -->
      <h1
        class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-8 leading-tight tracking-tight"
      set:html={post.title.rendered} />

      <!-- Excerpt -->
      {
        post.description && (
          <p class="text-base text-gray-400 mb-10">
            {post.description.rendered.replace(/<[^>]*>/g, "").slice(0, 250)}
            {post.description.rendered.length > 250 ? "..." : ""}
          </p>
        )
      }
      <div class="flex flex-wrap items-center gap-4 mb-8">
        {
          post.category && (
            <span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-sm font-medium border border-orange-500/30">
              {post.category}
            </span>
          )
        }
      </div>
    </div>
  </section>
  
  <!--  -->
  <main class="bg-gray-900 text-white py-12 md:py-20">
    <div class="max-w-5xl mx-auto px-4 md:px-6">
      <article
        class="bg-gray-800/50 p-8 rounded-2xl border border-gray-700 backdrop-blur-sm shadow-xl"
      >
        <div class="project-content" set:html={sanitizedContent} />
      </article>

      <!-- Línea divisoria decorativa -->
      <!-- Línea divisoria decorativa -->
      <div class="relative my-20">
        <div
          class="h-px bg-linear-to-r from-transparent via-slate-600 to-transparent"
        >
        </div>
        <div
          class="absolute inset-0 flex items-center justify-center pointer-events-none"
        >
          <div
            class="w-4 h-4 bg-green-600 rounded-full ring-4 ring-slate-900 shadow-lg shadow-orange-500/20 animate-pulse"
          >
          </div>
        </div>
      </div>

      <!-- CTA final genérica -->
      <section class="text-center mt-20">
        <div
          class="relative bg-slate-800/40 backdrop-blur-md border border-slate-700/50 rounded-3xl shadow-2xl p-10 md:p-14 overflow-hidden"
        >
          <!-- Efecto decorativo -->
          <div
            class="absolute inset-0 bg-linear-to-br from-orange-500/5 via-transparent to-blue-500/5 rounded-3xl"
          >
          </div>

          <h2
            class="relative text-3xl md:text-4xl font-extrabold text-white mb-6 tracking-tight bg-linear-to-r from-white via-slate-200 to-slate-400 bg-clip-text"
          >
            ¿Te resultó interesante este contenido?
          </h2>

          <p
            class="relative text-slate-400 text-lg md:text-xl mb-10 max-w-2xl mx-auto leading-relaxed"
          >
            Si deseas obtener más información, colaborar o compartir tus ideas,
            estaremos encantados de escucharte.
          </p>

          <div class="relative flex justify-center">
            <a
              href="/#contact"
              class="inline-flex items-center gap-3 px-8 py-4 bg-green-600/90 hover:bg-green-600 text-white font-semibold rounded-2xl border border-green-400/30 transition-all duration-300 hover:scale-105 hover:shadow-[0_0_20px_rgba(34,197,94,0.4)] group"
            >
              <span>Contactar</span>
              <ExternalLink
                class="w-5 h-5 transition-transform group-hover:translate-x-1"
              />
            </a>
          </div>
        </div>
      </section>

      <!-- Volver mejorado -->
      <div class="mt-16 text-center">
        <a
          href="/#projects"
          class="inline-flex items-center gap-2 text-slate-400 hover:text-orange-400 transition-all duration-300 font-semibold group"
        >
          <ArrowLeft
            class="w-5 h-5 transition-transform group-hover:-translate-x-1"
          />
          <span
            class="border-b border-transparent group-hover:border-current transition-all duration-200"
          >
            Volver a todos los contenidos
          </span>
        </a>
      </div>
    </div>
  </main>

  <style>
    .wordpress-content ul,
    .wordpress-content ol {
      margin: 1rem 0;
      padding-left: 2rem;
      list-style-position: outside;
    }
    .wordpress-content ul {
      list-style-type: disc;
    }
    .wordpress-content ol {
      list-style-type: decimal;
    }
    .wordpress-content li {
      margin: 0.5rem 0;
      line-height: 1.75;
      color: #d1d5db;
    }
    .wordpress-content ul li::marker,
    .wordpress-content ol li::marker {
      color: #f97316;
    }

    .wordpress-content .wp-block-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin: 0;
      padding: 0;
    }
    .wordpress-content .wp-block-gallery figure {
      margin: 0;
      overflow: hidden;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }
    .wordpress-content .wp-block-gallery figure:hover {
      transform: scale(1.05);
    }

    .wordpress-content pre,
    .wordpress-content code {
      background-color: #1f2937;
      color: #fff;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      display: block;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .wordpress-content a {
      color: #f97316;
      text-decoration: underline;
    }

    .wordpress-content img {
      border-radius: 0.5rem;
      max-width: 100%;
      height: auto;
    }
  </style>
</Layout>
